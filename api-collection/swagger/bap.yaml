openapi: 3.0.3
info:
  title: BAP - EV Charging Network API
  description: |
    Beckn Application Platform (BAP) API for EV Charging Network.
    
    **Asynchronous Communication Pattern:**
    - All requests follow an asynchronous communication pattern
    - Each request immediately returns an ACK (200 OK) or NAK (error response)
    - ACK indicates the request was accepted and will be processed asynchronously
    - NAK indicates the request was rejected due to validation errors or other issues
    - Actual response data will be sent asynchronously via callback endpoints
    
    **Response Flow:**
    - On success: Returns 200 OK with an acknowledgment
    - On error: Returns appropriate HTTP error status (400, 500, etc.) with error details
    - Async responses: Actual business responses are delivered via callback endpoints (e.g., on_discover, on_select)
  version: 1.0.0
  contact:
    name: EV Charging Network API Support
    email: support@evcharging.network

servers:
  - url: http://localhost:8081/bap/caller
    description: Local BAP Adapter (Development)
  - url: http://onix-bap:8081/bap/caller
    description: BAP Adapter (Docker)

tags:
  - name: Discovery
    description: Discovery operations to find EV charging stations
  - name: Order Management
    description: Order lifecycle management operations
  - name: Tracking
    description: Order tracking and status monitoring
  - name: Support
    description: Support and rating operations

paths:
  /discover:
    post:
      tags:
        - Discovery
      summary: Discover EV charging stations
      description: |
        Search for EV charging stations based on various criteria such as:
        - Location (spatial queries: point, line, polygon)
        - Station/EVSE filters
        - Connector type and power specifications
        - Time range availability
        - Vehicle compatibility
        
        Returns ACK/NAK immediately. The actual catalog response is sent asynchronously via `on_discover` callback.
      operationId: discover
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DiscoverRequest'
            examples:
              withinBoundary:
                summary: Search within a boundary (Point + radius)
                value:
                  context:
                    version: "2.0.0"
                    action: "discover"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d02"
                    timestamp: "2025-10-14T07:31:00Z"
                    ttl: "PT30S"
                    schema_context:
                      - "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingService/v1/context.jsonld"
                  message:
                    spatial:
                      - op: "s_dwithin"
                        targets: "$['beckn:availableAt'][*]['geo']"
                        geometry:
                          type: "Point"
                          coordinates: [77.59, 12.94]
                        distanceMeters: 10000
              alongRoute:
                summary: Search along a route (LineString)
                value:
                  context:
                    version: "2.0.0"
                    action: "discover"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d02"
                    timestamp: "2025-10-14T07:31:00Z"
                    ttl: "PT30S"
                    schema_context:
                      - "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingService/v1/context.jsonld"
                  message:
                    spatial:
                      - op: "s_dwithin"
                        targets: "$['beckn:availableAt'][*]['geo']"
                        geometry:
                          type: "LineString"
                          coordinates: [[77.5946, 12.9716], [76.6394, 12.2958]]
                        distanceMeters: 5000
              byConnectorSpec:
                summary: Search by connector specification (CCS2 with min 50kW)
                value:
                  context:
                    version: "2.0.0"
                    action: "discover"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d02"
                    timestamp: "2025-10-14T07:31:00Z"
                    ttl: "PT30S"
                    schema_context:
                      - "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingService/v1/context.jsonld"
                  message:
                    filters:
                      type: "jsonpath"
                      expression: "$[?(@.beckn:itemAttributes.connectorType == 'CCS2' && @.beckn:itemAttributes.maxPowerKW >= 50)]"
                    spatial:
                      - op: "s_dwithin"
                        targets: "$['beckn:availableAt'][*]['geo']"
                        geometry:
                          type: "Point"
                          coordinates: [77.59, 12.94]
                        distanceMeters: 10000
              byEVSE:
                summary: Search by specific EVSE ID
                value:
                  context:
                    version: "2.0.0"
                    action: "discover"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d02"
                    timestamp: "2025-10-14T07:31:00Z"
                    ttl: "PT30S"
                    schema_context:
                      - "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingService/v1/context.jsonld"
                  message:
                    filters:
                      type: "jsonpath"
                      expression: "$[?(@.beckn:itemAttributes.evseId == 'IN*ECO*BTM*01*CCS2*A')]"
              byCPO:
                summary: Search by CPO (Charge Point Operator)
                value:
                  context:
                    version: "2.0.0"
                    action: "discover"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d02"
                    timestamp: "2025-10-14T07:31:00Z"
                    ttl: "PT30S"
                    schema_context:
                      - "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingService/v1/context.jsonld"
                  message:
                    filters:
                      type: "jsonpath"
                      expression: "$[?(@.beckn:provider.beckn:id == 'ecopower-charging')]"
              byVehicleSpec:
                summary: Search by vehicle compatibility
                value:
                  context:
                    version: "2.0.0"
                    action: "discover"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d02"
                    timestamp: "2025-10-14T07:31:00Z"
                    ttl: "PT30S"
                    schema_context:
                      - "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingService/v1/context.jsonld"
                  message:
                    filters:
                      type: "jsonpath"
                      expression: "$[?(@.beckn:fulfillment.beckn:deliveryAttributes.vehicle.make == 'Tata' && @.beckn:fulfillment.beckn:deliveryAttributes.vehicle.model == 'Nexon-EV' )]"
                    spatial:
                      - op: "s_dwithin"
                        targets: "$['beckn:availableAt'][*]['geo']"
                        geometry:
                          type: "Point"
                          coordinates: [77.6, 12.95]
                        distanceMeters: 8000
              byQRCode:
                summary: Search by QR code scan (direct item lookup)
                value:
                  context:
                    version: "2.0.0"
                    action: "discover"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "app.example.com"
                    bap_uri: "https://app.example.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d02"
                    timestamp: "2025-10-14T07:31:00Z"
                    ttl: "PT30S"
                    schema_context:
                      - "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingService/v1/context.jsonld"
                  message:
                    filters:
                      type: "jsonpath"
                      expression: "$[?(@.beckn:id == 'IND*CPO1*cs-01*evse-01*connectorid-01')]"
              withinTimerange:
                summary: Search within time range with connector filter
                value:
                  context:
                    version: "2.0.0"
                    action: "discover"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d02"
                    timestamp: "2025-10-14T07:31:00Z"
                    ttl: "PT30S"
                    schema_context:
                      - "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingService/v1/context.jsonld"
                  message:
                    spatial:
                      - op: "s_dwithin"
                        targets: "$['beckn:availableAt'][*]['geo']"
                        geometry:
                          type: "Point"
                          coordinates: [77.59, 12.94]
                    filters:
                      type: "jsonpath"
                      expression: "$[?(@.beckn:itemAttributes.connectorType == 'CCS2' && @.beckn:availabilityWindow.schema:startTime <= '12:30:00' && @.beckn:availabilityWindow.schema:endTime >= '14:30:00')]"
      responses:
        '200':
          description: ACK - Request accepted and will be processed asynchronously
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
              example:
                message:
                  ack:
                    status: "ACK"
        '202':
          description: ACK - Request accepted (alternative status)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request (validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /select:
    post:
      tags:
        - Order Management
      summary: Select charging offer
      description: |
        Select a specific charging offer from the discovered catalog.
        Returns ACK/NAK immediately. The actual selection response is sent asynchronously via `on_select` callback.
      operationId: select
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SelectRequest'
            examples:
              timeBasedSlot:
                summary: Select time-based charging slot
                value:
                  context:
                    version: "2.0.0"
                    action: "select"
                    domain: "beckn.one:deg:ev-charging"
                    timestamp: "2024-01-15T10:30:00Z"
                    message_id: "bb9f86db-9a3d-4e9c-8c11-81c8f1a7b901"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    ttl: "PT30S"
                    bpp_id: "example-bpp.com"
                    bpp_uri: "https://example-bpp.com/bpp"
                  message:
                    order:
                      "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                      "@type": "beckn:Order"
                      "beckn:orderStatus": "CREATED"
                      "beckn:seller": "ecopower-charging"
                      "beckn:buyer":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/draft/schema/core/v2/context.jsonld"
                        "@type": "beckn:Buyer"
                        "beckn:id": "user-123"
                        "beckn:role": "BUYER"
                        "beckn:displayName": "Ravi Kumar"
                        "beckn:telephone": "+91-9876543210"
                        "beckn:email": "ravi.kumar@example.com"
                        "beckn:taxID": "GSTIN29ABCDE1234F1Z5"
                      "beckn:orderItems":
                        - "beckn:orderedItem": "IND*ecopower-charging*cs-01*IN*ECO*BTM*01*CCS2*A*CCS2-A"
                          "beckn:quantity":
                            unitText: "Kilowatt Hour"
                            unitCode: "KWH"
                            unitQuantity: 2.5
                          "beckn:acceptedOffer":
                            "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                            "@type": "beckn:Offer"
                            "beckn:id": "offer-ccs2-60kw-kwh"
                            "beckn:descriptor":
                              "@type": "beckn:Descriptor"
                              "schema:name": "Per-kWh Tariff - CCS2 60kW"
                            "beckn:items":
                              - "IND*ecopower-charging*cs-01*IN*ECO*BTM*01*CCS2*A*CCS2-A"
                            "beckn:provider": "ecopower-charging"
                            "beckn:price":
                              currency: "INR"
                              value: 45.0
                              applicableQuantity:
                                unitText: "Kilowatt Hour"
                                unitCode: "KWH"
                                unitQuantity: 1
                      "beckn:orderAttributes":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingSession/v1/context.jsonld"
                        "@type": "ChargingSession"
                        buyerFinderFee:
                          feeType: "PERCENTAGE"
                          feeValue: 2.5
                        preferences:
                          startTime: "2026-01-04T08:00:00+05:30"
                          endTime: "2026-01-04T20:00:00+05:30"
      responses:
        '200':
          description: ACK - Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /init:
    post:
      tags:
        - Order Management
      summary: Initialize order
      description: |
        Initialize an order with charging session details.
        Returns ACK/NAK immediately. The actual initialization response with quote is sent asynchronously via `on_init` callback.
      operationId: init
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InitRequest'
            examples:
              initChargingSession:
                summary: Initialize charging session order
                value:
                  context:
                    version: "2.0.0"
                    action: "init"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "6743e9e2-4fb5-487c-92b7-13ba8018f176"
                    timestamp: "2025-01-27T10:00:00Z"
                    ttl: "PT30S"
                    bpp_id: "example-bpp.com"
                    bpp_uri: "https://example-bpp.com/bpp"
                  message:
                    order:
                      "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                      "@type": "beckn:Order"
                      "beckn:id": "order-ev-charging-001"
                      "beckn:orderStatus": "CREATED"
                      "beckn:seller": "cpo1.com"
                      "beckn:buyer":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                        "@type": "beckn:Buyer"
                        "beckn:id": "user-123"
                        "beckn:role": "BUYER"
                        "beckn:displayName": "Ravi Kumar"
                        "beckn:telephone": "+91-9876543210"
                        "beckn:email": "ravi.kumar@example.com"
                        "beckn:taxID": "GSTIN29ABCDE1234F1Z5"
                      "beckn:orderItems":
                        - "beckn:orderedItem": "IND*ecopower-charging*cs-01*IN*ECO*BTM*01*CCS2*A*CCS2-A"
                          "beckn:quantity":
                            unitText: "Kilowatt Hour"
                            unitCode: "KWH"
                            unitQuantity: 2.5
                          "beckn:price":
                            currency: "INR"
                            value: 45.0
                            applicableQuantity:
                              unitText: "Kilowatt Hour"
                              unitCode: "KWH"
                              unitQuantity: 1
                      "beckn:orderValue":
                        currency: "INR"
                        value: 143.95
                        components:
                          - type: "UNIT"
                            value: 112.5
                            currency: "INR"
                            description: "Base charging session cost (45 INR/kWh × 2.5 kWh)"
                          - type: "SURCHARGE"
                            value: 20.0
                            currency: "INR"
                            description: "Surge price (20%)"
                          - type: "DISCOUNT"
                            value: -15.0
                            currency: "INR"
                            description: "Offer discount (15%)"
                          - type: "FEE"
                            value: 10.0
                            currency: "INR"
                            description: "Service fee"
                          - type: "FEE"
                            value: 13.64
                            currency: "INR"
                            description: "Overcharge estimation"
                          - type: "FEE"
                            value: 2.81
                            currency: "INR"
                            description: "Buyer finder fee (2.5%)"
                      "beckn:payment":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                        "@type": "beckn:Payment"
                        "beckn:id": "payment-123e4567-e89b-12d3-a456-426614174000"
                        "beckn:amount":
                          currency: "INR"
                          value: 143.95
                        "beckn:beneficiary": "BAP"
                        "beckn:paymentStatus": "INITIATED"
                        "beckn:paymentAttributes":
                          "@context": "https://raw.githubusercontent.com/bhim/ubc-tsd/main/beckn-schemas/UBCExtensions/v1/context.jsonld"
                          "@type": "UBCPaymentAttributes"
                          settlementAccounts:
                            - beneficiaryId: "example-bap.com"
                              accountHolderName: "Example BAP Solutions Pvt Ltd"
                              accountNumber: "9876543210123"
                              ifscCode: "HDFC0009876"
                              bankName: "HDFC Bank"
                              vpa: "example-bap@paytm"
      responses:
        '200':
          description: ACK - Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /confirm:
    post:
      tags:
        - Order Management
      summary: Confirm order
      description: |
        Confirm and finalize the order for charging session.
        Returns ACK/NAK immediately. The actual confirmation response is sent asynchronously via `on_confirm` callback.
      operationId: confirm
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfirmRequest'
            examples:
              confirmChargingSession:
                summary: Confirm charging session booking
                value:
                  context:
                    version: "2.0.0"
                    action: "confirm"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "c69b4c1e-fb7e-469d-ae90-00f4d5e82b64"
                    timestamp: "2025-01-27T10:05:00Z"
                    ttl: "PT30S"
                    bpp_id: "example-bpp.com"
                    bpp_uri: "https://example-bpp.com/bpp"
                  message:
                    order:
                      "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                      "@type": "beckn:Order"
                      "beckn:id": "order-ev-charging-001"
                      "beckn:orderStatus": "PENDING"
                      "beckn:seller": "cpo1.com"
                      "beckn:buyer":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                        "@type": "beckn:Buyer"
                        "beckn:id": "user-123"
                        "beckn:role": "BUYER"
                        "beckn:displayName": "Ravi Kumar"
                        "beckn:telephone": "+91-9876543210"
                        "beckn:email": "ravi.kumar@example.com"
                        "beckn:taxID": "GSTIN29ABCDE1234F1Z5"
                        "beckn:buyerAttributes":
                          "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/PaymentSettlement/v1/context.jsonld"
                          "@type": "BuyerPaymentInfo"
                          vpa: "ravikumar@upi"
                      "beckn:orderItems":
                        - "beckn:orderedItem": "IND*ecopower-charging*cs-01*IN*ECO*BTM*01*CCS2*A*CCS2-A"
                          "beckn:quantity":
                            unitText: "Kilowatt Hour"
                            unitCode: "KWH"
                            unitQuantity: 2.5
                          "beckn:price":
                            currency: "INR"
                            value: 45.0
                            applicableQuantity:
                              unitText: "Kilowatt Hour"
                              unitCode: "KWH"
                              unitQuantity: 1
                      "beckn:orderValue":
                        currency: "INR"
                        value: 143.95
                        components:
                          - type: "UNIT"
                            value: 112.5
                            currency: "INR"
                            description: "Base charging session cost (45 INR/kWh × 2.5 kWh)"
                          - type: "SURCHARGE"
                            value: 20.0
                            currency: "INR"
                            description: "Surge price (20%)"
                          - type: "DISCOUNT"
                            value: -15.0
                            currency: "INR"
                            description: "Offer discount (15%)"
                          - type: "FEE"
                            value: 10.0
                            currency: "INR"
                            description: "Service fee"
                          - type: "FEE"
                            value: 13.64
                            currency: "INR"
                            description: "Overcharge estimation"
                          - type: "FEE"
                            value: 2.81
                            currency: "INR"
                            description: "Buyer finder fee (2.5%)"
                      "beckn:payment":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                        "@type": "beckn:Payment"
                        "beckn:id": "payment-123e4567-e89b-12d3-a456-426614174000"
                        "beckn:amount":
                          currency: "INR"
                          value: 143.95
                        "beckn:paymentURL": "https://payments.bluechargenet-aggregator.io/pay?transaction_id=$transaction_id&amount=$amount"
                        "beckn:txnRef": "TXN-123456789"
                        "beckn:paidAt": "2025-12-19T10:05:00Z"
                        "beckn:beneficiary": "BPP"
                        "beckn:paymentStatus": "COMPLETED"
      responses:
        '200':
          description: ACK - Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /update:
    post:
      tags:
        - Order Management
      summary: Update order
      description: |
        Update an existing order with new information (e.g., start/end charging session).
        Returns ACK/NAK immediately. The actual update response is sent asynchronously via `on_update` callback.
      operationId: update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRequest'
            examples:
              endChargingSession:
                summary: End charging session
                value:
                  context:
                    version: "2.0.0"
                    action: "update"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    bpp_id: "example-bpp.com"
                    bpp_uri: "https://example-bpp.com/bpp"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "a1eabf26-29f5-4a01-9d4e-4c5c9d1a3d03"
                    timestamp: "2025-01-27T11:30:00Z"
                    ttl: "PT30S"
                  message:
                    order:
                      "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                      "@type": "beckn:Order"
                      "beckn:id": "order-ev-charging-001"
                      "beckn:orderStatus": "CONFIRMED"
                      "beckn:seller": "cpo1.com"
                      "beckn:buyer":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                        "@type": "beckn:Buyer"
                        "beckn:id": "user-123"
                        "beckn:role": "BUYER"
                        "beckn:displayName": "Ravi Kumar"
                        "beckn:telephone": "+91-9876543210"
                        "beckn:email": "ravi.kumar@example.com"
                        "beckn:taxID": "GSTIN29ABCDE1234F1Z5"
                        "beckn:buyerAttributes":
                          "@context": "https://raw.githubusercontent.com/bhim/ubc-tsd/main/beckn-schemas/UBCExtensions/v1/context.jsonld"
                          "@type": "BuyerUPI"
                          vpa: "ravikumar@upi"
                      "beckn:orderItems":
                        - "beckn:orderedItem": "IND*ecopower-charging*cs-01*IN*ECO*BTM*01*CCS2*A*CCS2-A"
                      "beckn:orderValue":
                        currency: "INR"
                        value: 143.95
                        components:
                          - type: "UNIT"
                            value: 112.5
                            currency: "INR"
                            description: "Base charging session cost (45 INR/kWh × 2.5 kWh)"
                          - type: "SURCHARGE"
                            value: 20.0
                            currency: "INR"
                            description: "Surge price (20%)"
                          - type: "DISCOUNT"
                            value: -15.0
                            currency: "INR"
                            description: "Offer discount (15%)"
                          - type: "FEE"
                            value: 10.0
                            currency: "INR"
                            description: "Service fee"
                          - type: "FEE"
                            value: 13.64
                            currency: "INR"
                            description: "Overcharge estimation"
                          - type: "FEE"
                            value: 2.81
                            currency: "INR"
                            description: "Buyer finder fee (2.5%)"
                      "beckn:fulfillment":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                        "@type": "beckn:Fulfillment"
                        "beckn:id": "fulfillment-001"
                        "beckn:mode": "RESERVATION"
                        "beckn:deliveryAttributes":
                          "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/EvChargingSession/v1/context.jsonld"
                          "@type": "ChargingSession"
                          connectorType: "CCS2"
                          maxPowerKW: 50
                          sessionStatus: "PENDING"
                      "beckn:payment":
                        "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                        "@type": "beckn:Payment"
                        "beckn:id": "payment-123e4567-e89b-12d3-a456-426614174000"
                        "beckn:amount":
                          currency: "INR"
                          value: 143.95
                        "beckn:paymentURL": "https://payments.bluechargenet-aggregator.io/pay?transaction_id=$transaction_id&amount=$amount"
                        "beckn:txnRef": "TXN-123456789"
                        "beckn:paidAt": "2025-12-19T10:05:00Z"
                        "beckn:beneficiary": "BPP"
                        "beckn:paymentStatus": "COMPLETED"
                        "beckn:paymentAttributes":
                          "@context": "https://raw.githubusercontent.com/bhim/ubc-tsd/main/beckn-schemas/UBCExtensions/v1/context.jsonld"
                          "@type": "UBCPaymentAttributes"
                          upiTransactionId: "UPI123456789012"
      responses:
        '200':
          description: ACK - Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /track:
    post:
      tags:
        - Tracking
      summary: Track order status
      description: |
        Request current status of an order.
        Returns ACK/NAK immediately. The actual tracking response is sent asynchronously via `on_track` callback.
      operationId: track
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrackRequest'
            examples:
              trackChargingSession:
                summary: Track active charging session
                value:
                  context:
                    version: "2.0.0"
                    action: "track"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "6ace310b-6440-4421-a2ed-b484c7548bd5"
                    timestamp: "2025-01-27T17:00:40.065Z"
                    ttl: "PT30S"
                    bpp_id: "example-bpp.com"
                    bpp_uri: "https://example-bpp.com/bpp"
                  message:
                    order:
                      "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/draft/schema/core/v2/context.jsonld"
                      "@type": "beckn:Order"
                      "beckn:id": "order-bpp-789012"
      responses:
        '200':
          description: ACK - Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cancel:
    post:
      tags:
        - Order Management
      summary: Cancel order
      description: |
        Cancel an existing order or order items.
        Returns ACK/NAK immediately. The actual cancellation response is sent asynchronously via `on_cancel` callback.
      operationId: cancel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelRequest'
            examples:
              cancelReservedSlot:
                summary: Cancel reserved charging slot
                value:
                  context:
                    version: "2.0.0"
                    domain: "beckn.one:deg:ev-charging"
                    action: "cancel"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "4a736341-8897-4e5a-9873-53533691f42d"
                    timestamp: "2025-01-27T12:15:30Z"
                    ttl: "PT30S"
                    bpp_id: "example-bpp.com"
                    bpp_uri: "https://example-bpp.com/bpp"
                  message:
                    order:
                      - "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                        "@type": "beckn:Order"
                        "beckn:id": "order-ev-charging-001"
                        "beckn:orderStatus": "CONFIRMED"
                        "beckn:seller": "cpo1.com"
                        "beckn:buyer":
                          "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/core/v2/context.jsonld"
                          "@type": "beckn:Buyer"
                          "beckn:id": "user-123"
                          "beckn:buyerAttributes":
                            "@context": "https://raw.githubusercontent.com/beckn/protocol-specifications-new/refs/heads/main/schema/PaymentSettlement/v1/context.jsonld"
                            "@type": "BuyerPaymentInfo"
                            vpa: "ravikumar@upi"
                        "beckn:orderItems":
                          - "beckn:orderedItem": "IND*ecopower-charging*cs-01*IN*ECO*BTM*01*CCS2*A*CCS2-A"
                            "beckn:quantity":
                              unitText: "Kilowatt Hour"
                              unitCode: "KWH"
                              unitQuantity: 2.5
      responses:
        '200':
          description: ACK - Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /rating:
    post:
      tags:
        - Support
      summary: Submit rating
      description: |
        Submit a rating and feedback for an order, fulfillment, provider, or item.
        Returns ACK/NAK immediately. The actual rating response is sent asynchronously via `on_rating` callback.
      operationId: rating
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RatingRequest'
            examples:
              rateChargingSession:
                summary: Rate charging session fulfillment
                value:
                  context:
                    version: "2.0.0"
                    action: "rating"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "89ee20fe-b592-48b0-a5c5-e38f6b90e569"
                    timestamp: "2025-01-27T12:00:00Z"
                    ttl: "PT30S"
                    bpp_id: "example-bpp.com"
                    bpp_uri: "https://example-bpp.com/bpp"
                  message:
                    id: "fulfillment-001"
                    value: 5
                    best: 5
                    worst: 1
                    category: "fulfillment"
                    feedback:
                      comments: "Excellent charging experience! The station was clean, easy to find, and the charging was fast and reliable. The staff was helpful and the payment process was smooth."
                      tags:
                        - "fast-charging"
                        - "easy-to-use"
                        - "clean-station"
                        - "helpful-staff"
                        - "smooth-payment"
      responses:
        '200':
          description: ACK - Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /support:
    post:
      tags:
        - Support
      summary: Request support
      description: |
        Request support for an order, fulfillment, item, or payment.
        Returns ACK/NAK immediately. The actual support response is sent asynchronously via `on_support` callback.
      operationId: support
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SupportRequest'
            examples:
              requestOrderSupport:
                summary: Request support for an order
                value:
                  context:
                    version: "2.0.0"
                    action: "support"
                    domain: "beckn.one:deg:ev-charging"
                    bap_id: "example-bap.com"
                    bap_uri: "https://example-bap.com/bap"
                    transaction_id: "2b4d69aa-22e4-4c78-9f56-5a7b9e2b2002"
                    message_id: "dee432d9-36c9-4146-ad21-2f5bcac9b6a9"
                    timestamp: "2025-01-27T12:15:00Z"
                    ttl: "PT30S"
                    bpp_id: "example-bpp.com"
                    bpp_uri: "https://example-bpp.com/bpp"
                  message:
                    ref_id: "order-bpp-789012"
                    ref_type: "order"
      responses:
        '200':
          description: ACK - Request accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AckResponse'
        '400':
          description: NAK - Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: NAK - Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    AckResponse:
      type: object
      properties:
        message:
          type: object
          properties:
            ack:
              type: object
              properties:
                status:
                  type: string
                  enum: ["ACK"]
                  description: Acknowledgment status
          required:
            - ack
      required:
        - message
      example:
        message:
          ack:
            status: "ACK"

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            type:
              type: string
              description: Error type
            code:
              type: string
              description: Error code
            path:
              type: string
              description: Path to the error location
            message:
              type: string
              description: Error message
          required:
            - type
            - code
            - message

    Context:
      type: object
      properties:
        version:
          type: string
          description: Version of the Beckn protocol
          example: "2.0.0"
        action:
          type: string
          description: API endpoint to be called
        domain:
          type: string
          description: Identifier of the domain
          example: "beckn.one:deg:ev-charging"
        bap_id:
          type: string
          description: Identification of the BAP
        bap_uri:
          type: string
          format: uri
          description: BAP endpoint
        bpp_id:
          type: string
          description: Identification of the BPP
        bpp_uri:
          type: string
          format: uri
          description: BPP endpoint
        transaction_id:
          type: string
          description: Transaction identifier
        message_id:
          type: string
          description: Message identifier
        timestamp:
          type: string
          format: date-time
          description: Time at which the request was generated
        ttl:
          type: string
          description: Time to live (ISO 8601 duration format)
          example: "PT30S"
        schema_context:
          type: array
          items:
            type: string
            format: uri
          description: Schema context URLs
      required:
        - version
        - action
        - domain
        - bap_id
        - bap_uri
        - transaction_id
        - message_id
        - timestamp

    DiscoverRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            text_search:
              type: string
              description: Text-based search query
            spatial:
              type: array
              items:
                type: object
                properties:
                  op:
                    type: string
                    enum: ["s_dwithin", "s_within", "s_intersects"]
                    description: Spatial operation
                  targets:
                    type: string
                    description: JSONPath expression to target elements
                    example: "$['beckn:availableAt'][*]['geo']"
                  geometry:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: ["Point", "LineString", "Polygon"]
                      coordinates:
                        oneOf:
                          - type: array
                            items:
                              type: number
                            minItems: 2
                            maxItems: 2
                            description: Point coordinates [longitude, latitude]
                          - type: array
                            items:
                              type: array
                              items:
                                type: number
                            description: LineString or Polygon coordinates
                    required:
                      - type
                      - coordinates
                  distanceMeters:
                    type: number
                    description: Distance in meters for spatial queries
                required:
                  - op
                  - targets
                  - geometry
            filters:
              type: object
              properties:
                type:
                  type: string
                  enum: ["jsonpath"]
                  description: Filter type
                expression:
                  type: string
                  description: JSONPath expression for filtering
              required:
                - type
                - expression
      required:
        - context
        - message

    SelectRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            order:
              $ref: '#/components/schemas/Order'
          required:
            - order
      required:
        - context
        - message

    InitRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            order:
              $ref: '#/components/schemas/Order'
          required:
            - order
      required:
        - context
        - message

    ConfirmRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            order:
              $ref: '#/components/schemas/Order'
          required:
            - order
      required:
        - context
        - message

    UpdateRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            order:
              $ref: '#/components/schemas/Order'
          required:
            - order
      required:
        - context
        - message

    TrackRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            order:
              type: object
              properties:
                "@context":
                  type: string
                  format: uri
                "@type":
                  type: string
                  enum: ["beckn:Order"]
                "beckn:id":
                  type: string
              required:
                - "@type"
                - "beckn:id"
          required:
            - order
      required:
        - context
        - message

    CancelRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            order:
              type: array
              items:
                type: object
                properties:
                  "@context":
                    type: string
                    format: uri
                  "@type":
                    type: string
                    enum: ["beckn:Order"]
                  "beckn:id":
                    type: string
                  "beckn:orderStatus":
                    type: string
                  "beckn:seller":
                    type: string
                  "beckn:buyer":
                    type: object
                  "beckn:orderItems":
                    type: array
                    items:
                      type: object
                      properties:
                        "beckn:orderedItem":
                          type: string
                        "beckn:quantity":
                          type: object
                required:
                  - "@type"
                  - "beckn:id"
              minItems: 1
          required:
            - order
      required:
        - context
        - message

    RatingRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            id:
              type: string
              description: Rating identifier (e.g., fulfillment ID)
            value:
              type: number
              minimum: 1
              description: Rating value
            best:
              type: number
              description: Best possible rating value
            worst:
              type: number
              description: Worst possible rating value
            category:
              type: string
              enum: ["fulfillment", "provider", "item"]
              description: Category of the rating
            feedback:
              type: object
              properties:
                comments:
                  type: string
                  description: Textual feedback comments
                tags:
                  type: array
                  items:
                    type: string
                  description: Feedback tags
          required:
            - id
            - value
      required:
        - context
        - message

    SupportRequest:
      type: object
      properties:
        context:
          $ref: '#/components/schemas/Context'
        message:
          type: object
          properties:
            ref_id:
              type: string
              description: Reference ID (e.g., order ID)
            ref_type:
              type: string
              enum: ["order", "fulfillment", "item", "payment"]
              description: Type of reference
          required:
            - ref_id
            - ref_type
      required:
        - context
        - message

    Order:
      type: object
      description: Order object with varying structure based on endpoint
      properties:
        "@context":
          type: string
          format: uri
        "@type":
          type: string
          enum: ["beckn:Order"]
        "beckn:id":
          type: string
        "beckn:orderStatus":
          type: string
          enum: ["CREATED", "PENDING", "CONFIRMED", "ACTIVE", "INPROGRESS", "COMPLETED", "CANCELLED"]
        "beckn:orderNumber":
          type: string
        "beckn:seller":
          type: string
        "beckn:buyer":
          oneOf:
            - type: string
            - type: object
              properties:
                "@context":
                  type: string
                "@type":
                  type: string
                "beckn:id":
                  type: string
                "beckn:role":
                  type: string
                "beckn:displayName":
                  type: string
                "beckn:telephone":
                  type: string
                "beckn:email":
                  type: string
                "beckn:taxID":
                  type: string
                "beckn:buyerAttributes":
                  type: object
        "beckn:orderItems":
          type: array
          items:
            type: object
            properties:
              "beckn:orderedItem":
                type: string
              "beckn:quantity":
                type: object
                properties:
                  unitText:
                    type: string
                  unitCode:
                    type: string
                  unitQuantity:
                    type: number
              "beckn:acceptedOffer":
                type: object
              "beckn:price":
                type: object
        "beckn:orderValue":
          type: object
          properties:
            currency:
              type: string
            value:
              type: number
            components:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                    enum: ["UNIT", "SURCHARGE", "DISCOUNT", "FEE"]
                  value:
                    type: number
                  currency:
                    type: string
                  description:
                    type: string
        "beckn:fulfillment":
          type: object
        "beckn:payment":
          type: object
        "beckn:orderAttributes":
          type: object
